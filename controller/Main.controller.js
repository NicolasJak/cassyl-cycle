sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/WizardStep","sap/m/Wizard","sap/m/Text","sap/m/HBox","sap/m/Input","sap/m/DatePicker","sap/m/VBox","sap/m/List","sap/m/InputListItem","sap/m/Label","libs/moments.min"],function(t,e,n,r,a,o,s,l,i,d,c,y,g,u){"use strict";return t.extend("cassyl.cycle.controller.Main",{onInit:function(){const t=Array.from({length:4},(t,e)=>({date:"",label:`Cycle ${e+1} - 1er jour des règles`,required:e<2}));const n=new e({knowsCycleDuration:null,cycles:t,averageCycleLength:null,averageCycleText:null,startDate:null,ovulationDate:null,fertileStart:null,fertileEnd:null,fertilitySummary:null,NidationStart:null,NidationEnd:null,PriseSang:null,Nextcycle:null});this.getView().setModel(n,"viewModel");this._oNavContainer=this.byId("wizardNavContainer")},onPressYes:function(t){this.byId("Step1").setValidated(true);this.byId("Step1").setNextStep(this.getView().byId("Step2a"));this.byId("Wizard").nextStep()},onPressNo:function(t){this.byId("Step1").setValidated(true);this.byId("Step1").setNextStep(this.getView().byId("Step2b"));this.byId("Wizard").nextStep()},check2a:function(t){if(this.getView().getModel("viewModel").getProperty("/averageCycleLength")&&this.getView().getModel("viewModel").getProperty("/startDate")){this.byId("Step2a").setValidated(true)}},check2b:function(t){const e=this.getView().getModel("viewModel").getProperty("/cycles");const n=e[0]?.date?.length>0&&e[1]?.date?.length>0;if(n){this.byId("Step2b").setValidated(true)}else{this.byId("Step2b").setValidated(false)}},onComplete:function(t){const e=this.getView().getModel("viewModel");this.calculatedata(e);const n=e.getProperty("/averageCycleLength");const r=n?`La durée moyenne de votre cycle est de : ${n} jours`:"La durée moyenne de votre cycle n'a pas pu être calculée.";e.setProperty("/averageCycleText",r);const a=t=>{if(!t)return"<i>non disponible</i>";const e=new Date(t);return e.toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})};const o=t=>{if(!t)return"<i>non disponible</i>";const e=new Date(t);if(g.month()===u.month()){return e.toLocaleDateString("fr-FR",{day:"2-digit"})}else{return e.toLocaleDateString("fr-FR",{day:"2-digit",month:"long"})}};const s=e.getProperty("/startDate");const l=new Date(s);const i=s?`Date des dernières règles : ${a(l)}`:"La date de début du cycle n'a pas été fournie.";e.setProperty("/startDateText",i);const d=e.getProperty("/ovulationDate");const c=e.getProperty("/fertileStart");const y=e.getProperty("/fertileEnd");const g=e.getProperty("/NidationStart");const u=e.getProperty("/NidationEnd");const p=e.getProperty("/PriseSang");const h=e.getProperty("/Nextcycle");const m=`🩷 <strong>Date d'ovulation :</strong> ${a(d)}<br>`+`🌱 <strong>Début de la période fertile :</strong> ${a(c)}<br>`+`🌸 <strong>Fin de la période fertile :</strong> ${a(y)}<br>`+`🪺 <strong>Nidation :</strong> entre le ${o(g)} et le ${a(u)}<br>`+`🩸 <strong>Prise de sang :</strong> à partir du ${a(p)}<br>`+`🔁 <strong>Prochain cycle :</strong> ${a(h)}`;e.setProperty("/fertilitySummary",m);this._oNavContainer.to(this.byId("ReviewPage"))},calculatedata:function(t){const e=this.byId("Wizard");const n=e.getCurrentStep();if(n.endsWith("Step2a")){}else if(n.endsWith("Step2b")){const e=t.getProperty("/cycles");const n=e.map(t=>t.date).filter(t=>!!t).map(t=>new Date(t));let r=[];for(let t=1;t<n.length;t++){const e=(n[t]-n[t-1])/(1e3*60*60*24);if(!isNaN(e)&&e>0){r.push(e)}}if(r.length>0){const e=r.reduce((t,e)=>t+e,0)/r.length;t.setProperty("/averageCycleLength",Math.round(e))}else{t.setProperty("/averageCycleLength",null)}if(n.length>0){const e=new Date(Math.max.apply(null,n));const r=e.getFullYear();const a=String(e.getMonth()+1).padStart(2,"0");const o=String(e.getDate()).padStart(2,"0");const s=`${r}-${a}-${o}`;t.setProperty("/startDate",s)}else{t.setProperty("/startDate",null)}}const r=t.getProperty("/averageCycleLength");const a=t.getProperty("/startDate");const o=moment(a).add(r-14,"days");const s=moment(o).subtract(4,"days");const l=moment(o).add(1,"days");const i=moment(o).add(6,"days");const d=moment(o).add(10,"days");const c=moment(o).add(12,"days");const y=moment(a).add(r,"days").format("YYYY-MM-DD");t.setProperty("/ovulationDate",o);t.setProperty("/fertileStart",s);t.setProperty("/fertileEnd",l);t.setProperty("/NidationStart",i);t.setProperty("/NidationEnd",d);t.setProperty("/PriseSang",c);t.setProperty("/Nextcycle",y)},handleWizardCancel:function(t){const e=this.byId("Wizard");e.discardProgress(e.getSteps()[0]);e.goToStep(e.getSteps()[0]);this.byId("Step1").setValidated(false);this.byId("Step2a").setValidated(false);this.byId("Step2b").setValidated(false);this._oNavContainer.to(this.byId("page"));this.getView().getModel("viewModel").setData({knowsCycleDuration:null,cycles:Array.from({length:4},(t,e)=>({date:"",label:`Cycle ${e+1} - 1er jour des règles`,required:e<2})),averageCycleLength:null,averageCycleText:null,startDate:null,ovulationDate:null,fertileStart:null,fertileEnd:null,fertilitySummary:null,NidationStart:null,NidationEnd:null,PriseSang:null,Nextcycle:null})}})});
//# sourceMappingURL=Main.controller.js.map